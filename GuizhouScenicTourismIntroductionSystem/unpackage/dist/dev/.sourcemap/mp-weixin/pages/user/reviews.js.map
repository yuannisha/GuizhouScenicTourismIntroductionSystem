{"version":3,"file":"reviews.js","sources":["pages/user/reviews.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9yZXZpZXdzLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"reviews-container\">\r\n\t\t<!-- 分类标签 -->\r\n\t\t<scroll-view class=\"category-scroll\" scroll-x>\r\n\t\t\t<view class=\"category-list\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tclass=\"category-item\" \r\n\t\t\t\t\t:class=\"{ active: currentCategory === item.value }\"\r\n\t\t\t\t\tv-for=\"item in categories\" \r\n\t\t\t\t\t:key=\"item.value\"\r\n\t\t\t\t\t@click=\"handleCategoryChange(item.value)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{{item.name}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t\r\n\t\t<!-- 评价列表 -->\r\n\t\t<scroll-view \r\n\t\t\tclass=\"review-list\"\r\n\t\t\tscroll-y\r\n\t\t\t@scrolltolower=\"loadMore\"\r\n\t\t\trefresher-enabled\r\n\t\t\t:refresher-triggered=\"isRefreshing\"\r\n\t\t\t@refresherrefresh=\"refresh\"\r\n\t\t>\r\n\t\t\t<view class=\"review-items\">\r\n\t\t\t\t<view \r\n\t\t\t\t\tclass=\"review-item\"\r\n\t\t\t\t\tv-for=\"(item, index) in reviewList\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<view class=\"target-info\" @click=\"goToDetail(item)\">\r\n\t\t\t\t\t\t<image :src=\"item.cover\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t<view class=\"info\">\r\n\t\t\t\t\t\t\t<text class=\"name\">{{item.name}}</text>\r\n\t\t\t\t\t\t\t<text v-if=\"currentCategory === 'scenic' || currentCategory === 'food'\" class=\"score\">{{item.score}}分</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"review-content\">\r\n\t\t\t\t\t\t<text class=\"content\">{{item.content}}</text>\r\n\t\t\t\t\t\t<view class=\"images\" v-if=\"item.images && item.images.length\">\r\n\t\t\t\t\t\t\t<image \r\n\t\t\t\t\t\t\t\tv-for=\"(img, imgIndex) in item.images\" \r\n\t\t\t\t\t\t\t\t:key=\"imgIndex\" \r\n\t\t\t\t\t\t\t\t:src=\"img\" \r\n\t\t\t\t\t\t\t\tmode=\"aspectFill\"\r\n\t\t\t\t\t\t\t\t@click=\"previewImage(item.images, imgIndex)\"\r\n\t\t\t\t\t\t\t></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<text class=\"time\">{{formatDate(item.created_at)}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载状态 -->\r\n\t\t\t<view class=\"loading-status\">\r\n\t\t\t\t<text v-if=\"loading\">加载中...</text>\r\n\t\t\t\t<text v-else-if=\"noMore\">没有更多了</text>\r\n\t\t\t\t<text v-else-if=\"reviewList.length === 0\">暂无评价</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { formatDate } from '@/utils/date.js'\r\n\r\n/**\r\n * 我的评价页面\r\n * @description 展示用户发表的景点、美食、文化和攻略评价\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcategories: [\r\n\t\t\t\t{ name: '景点', value: 'scenic' },\r\n\t\t\t\t{ name: '美食', value: 'food' },\r\n\t\t\t\t{ name: '文化', value: 'culture' },\r\n\t\t\t\t{ name: '攻略', value: 'guide' }\r\n\t\t\t],\r\n\t\t\tcurrentCategory: 'scenic',\r\n\t\t\treviewList: [],\r\n\t\t\tpage: 1,\r\n\t\t\tpageSize: 10,\r\n\t\t\tloading: false,\r\n\t\t\tnoMore: false,\r\n\t\t\tisRefreshing: false\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\tthis.loadReviews()\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 加载评价列表\r\n\t\t */\r\n\t\tasync loadReviews() {\r\n\t\t\tif (this.loading || this.noMore) return\r\n\t\t\t\r\n\t\t\tthis.loading = true\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-center',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'getReviews',\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tUSERID: uni.getStorageSync('userInfo')._id,\r\n\t\t\t\t\t\t\ttype: this.currentCategory,\r\n\t\t\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\t\t\tpageSize: this.pageSize\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tconst { list, total } = res.result.data\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.page === 1) {\r\n\t\t\t\t\t\tthis.reviewList = list\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.reviewList = [...this.reviewList, ...list]\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.noMore = this.reviewList.length >= total\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '加载失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '加载失败，请稍后重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tthis.isRefreshing = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 处理分类切换\r\n\t\t */\r\n\t\thandleCategoryChange(category) {\r\n\t\t\tthis.currentCategory = category\r\n\t\t\tthis.page = 1\r\n\t\t\tthis.noMore = false\r\n\t\t\tthis.reviewList = []\r\n\t\t\tthis.loadReviews()\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 加载更多\r\n\t\t */\r\n\t\tloadMore() {\r\n\t\t\tif (!this.loading && !this.noMore) {\r\n\t\t\t\tthis.page++\r\n\t\t\t\tthis.loadReviews()\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 刷新列表\r\n\t\t */\r\n\t\trefresh() {\r\n\t\t\tthis.isRefreshing = true\r\n\t\t\tthis.page = 1\r\n\t\t\tthis.noMore = false\r\n\t\t\tthis.loadReviews()\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 跳转到详情页\r\n\t\t */\r\n\t\tgoToDetail(item) {\r\n\t\t\tlet url = ''\r\n\t\t\tswitch (this.currentCategory) {\r\n\t\t\t\tcase 'scenic':\r\n\t\t\t\t\turl = `/pages/scenic/detail?id=${item.scenic_id}`\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 'food':\r\n\t\t\t\t\turl = `/pages/food/detail?id=${item.food_id}`\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 'culture':\r\n\t\t\t\t\turl = `/pages/culture/detail?id=${item.culture_id}`\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 'guide':\r\n\t\t\t\t\turl = `/pages/guide/detail?id=${item.guide_id}`\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tif (url) {\r\n\t\t\t\tuni.navigateTo({ url })\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 预览图片\r\n\t\t */\r\n\t\tpreviewImage(images, current) {\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: images,\r\n\t\t\t\tcurrent: images[current]\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 格式化日期\r\n\t\t */\r\n\t\tformatDate(timestamp) {\r\n\t\t\treturn formatDate(timestamp)\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.reviews-container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\t\r\n\t.category-scroll {\r\n\t\tbackground-color: #fff;\r\n\t\twhite-space: nowrap;\r\n\t\t\r\n\t\t.category-list {\r\n\t\t\tdisplay: flex;\r\n\t\t\tpadding: 20rpx;\r\n\t\t\t\r\n\t\t\t.category-item {\r\n\t\t\t\tpadding: 10rpx 30rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\t\r\n\t\t\t\t&.active {\r\n\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\tbackground-color: #007AFF;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t&:last-child {\r\n\t\t\t\t\tmargin-right: 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t.review-list {\r\n\t\theight: calc(100vh - 100rpx);\r\n\t\tpadding: 20rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\t\r\n\t\t.review-items {\r\n\t\t\t.review-item {\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\t\r\n\t\t\t\t.target-info {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\t\r\n\t\t\t\t\timage {\r\n\t\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.info {\r\n\t\t\t\t\t\tflex: 1;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t.name {\r\n\t\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t.score {\r\n\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.review-content {\r\n\t\t\t\t\t.content {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\tline-height: 1.6;\r\n\t\t\t\t\t\tmargin-bottom: 16rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.images {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\t\t\tmargin: 0 -8rpx;\r\n\t\t\t\t\t\tmargin-bottom: 16rpx;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\timage {\r\n\t\t\t\t\t\t\twidth: calc(33.33% - 16rpx);\r\n\t\t\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t\t\t\tmargin: 8rpx;\r\n\t\t\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.time {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.loading-status {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 20rpx;\r\n\t\t\t\r\n\t\t\ttext {\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/liululuprogram/first/GuizhouScenicTourismIntroductionSystem/pages/user/reviews.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni","formatDate"],"mappings":"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"}