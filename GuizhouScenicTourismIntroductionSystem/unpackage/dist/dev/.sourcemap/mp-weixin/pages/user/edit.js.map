{"version":3,"file":"edit.js","sources":["pages/user/edit.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"edit-profile-container\">\r\n\t\t<view class=\"form-group\">\r\n\t\t\t<!-- 头像 -->\r\n\t\t\t<view class=\"form-item avatar-item\">\r\n\t\t\t\t<text class=\"label\">头像</text>\r\n\t\t\t\t<view class=\"avatar-wrapper\" @click=\"handleChooseAvatar\">\r\n\t\t\t\t\t<image :src=\"formData.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<text class=\"tip\">点击更换头像</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 昵称 -->\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">昵称</text>\r\n\t\t\t\t<input \r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tv-model=\"formData.nickname\"\r\n\t\t\t\t\tplaceholder=\"请输入昵称\"\r\n\t\t\t\t\tmaxlength=\"32\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 手机号 -->\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">手机号</text>\r\n\t\t\t\t<text class=\"phone\">{{formData.phone}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 保存按钮 -->\r\n\t\t<view class=\"btn-group\">\r\n\t\t\t<button type=\"primary\" @click=\"handleSave\">保存</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 用户资料编辑页面\r\n * @description 编辑用户个人资料\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tformData: {\r\n\t\t\t\tavatar: '',\r\n\t\t\t\tnickname: '',\r\n\t\t\t\tphone: ''\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\tthis.loadUserInfo()\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 加载用户信息\r\n\t\t */\r\n\t\tloadUserInfo() {\r\n\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\tif (userInfo) {\r\n\t\t\t\tthis.formData = {\r\n\t\t\t\t\tavatar: userInfo.avatar || '',\r\n\t\t\t\t\tnickname: userInfo.nickname || '',\r\n\t\t\t\t\tphone: userInfo.phone || ''\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 处理选择头像\r\n\t\t */\r\n\t\thandleChooseAvatar() {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\tconst tempFilePath = res.tempFilePaths[0]\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 显示上传中\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '上传中...'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// 上传图片到云存储\r\n\t\t\t\t\t\tconst uploadRes = await uniCloud.uploadFile({\r\n\t\t\t\t\t\t\tfilePath: tempFilePath,\r\n\t\t\t\t\t\t\tcloudPath: `avatar/${Date.now()}-${Math.random().toString(36).slice(-6)}.jpg`\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.formData.avatar = uploadRes.fileID\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '上传失败，请重试',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 处理保存\r\n\t\t */\r\n\t\tasync handleSave() {\r\n\t\t\tif (!this.formData.nickname.trim()) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入昵称',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'user-center',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'updateProfile',\r\n\t\t\t\t\t\tparams: {\r\n                            USERID:uni.getStorageSync('userInfo')._id,\r\n\t\t\t\t\t\t\tavatar: this.formData.avatar,\r\n\t\t\t\t\t\t\tnickname: this.formData.nickname\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\t// 更新本地存储的用户信息\r\n\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\t\tuserInfo.avatar = this.formData.avatar\r\n\t\t\t\t\tuserInfo.nickname = this.formData.nickname\r\n\t\t\t\t\tuni.setStorageSync('userInfo', userInfo)\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '保存成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '保存失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '保存失败，请重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.edit-profile-container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\tpadding: 20rpx;\r\n\t\r\n\t.form-group {\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 12rpx;\r\n\t\toverflow: hidden;\r\n\t\t\r\n\t\t.form-item {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 30rpx;\r\n\t\t\tborder-bottom: 2rpx solid #f5f5f5;\r\n\t\t\t\r\n\t\t\t&:last-child {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.label {\r\n\t\t\t\twidth: 120rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tinput {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\theight: 60rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.phone {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t&.avatar-item {\r\n\t\t\t\tpadding: 40rpx 30rpx;\r\n\t\t\t\t\r\n\t\t\t\t.avatar-wrapper {\r\n\t\t\t\t\tflex: 1;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\r\n\t\t\t\t\timage {\r\n\t\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\t\tborder-radius: 60rpx;\r\n\t\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.tip {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t.btn-group {\r\n\t\tmargin-top: 60rpx;\r\n\t\tpadding: 0 40rpx;\r\n\t\t\r\n\t\tbutton {\r\n\t\t\twidth: 100%;\r\n\t\t}\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/liululuprogram/first/GuizhouScenicTourismIntroductionSystem/pages/user/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AA0CA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,UAAU;AAAA,QACT,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,OAAO;AAAA,MACR;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,aAAa;AAAA,EAClB;AAAA,EACD,SAAS;AAAA;AAAA;AAAA;AAAA,IAIR,eAAe;AACd,YAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,UAAI,UAAU;AACb,aAAK,WAAW;AAAA,UACf,QAAQ,SAAS,UAAU;AAAA,UAC3B,UAAU,SAAS,YAAY;AAAA,UAC/B,OAAO,SAAS,SAAS;AAAA,QAC1B;AAAA,MACD;AAAA,IACA;AAAA;AAAA;AAAA;AAAA,IAKD,qBAAqB;AACpBA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,OAAO,QAAQ;AACvB,gBAAM,eAAe,IAAI,cAAc,CAAC;AAGxCA,wBAAAA,MAAI,YAAY;AAAA,YACf,OAAO;AAAA,WACP;AAED,cAAI;AAEH,kBAAM,YAAY,MAAMC,cAAQ,GAAC,WAAW;AAAA,cAC3C,UAAU;AAAA,cACV,WAAW,UAAU,KAAK,IAAK,CAAA,IAAI,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,MAAM,EAAE,CAAC;AAAA,aACvE;AAED,iBAAK,SAAS,SAAS,UAAU;AAAA,UAClC,SAAS,GAAG;AACXD,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO;AAAA,cACP,MAAM;AAAA,aACN;AACDA,0BAAAA,MAAc,MAAA,SAAA,8BAAA,CAAC;AAAA,UAChB,UAAU;AACTA,0BAAAA,MAAI,YAAY;AAAA,UACjB;AAAA,QACD;AAAA,OACA;AAAA,IACD;AAAA;AAAA;AAAA;AAAA,IAKD,MAAM,aAAa;AAClB,UAAI,CAAC,KAAK,SAAS,SAAS,KAAI,GAAI;AACnCA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AACD;AAAA,MACD;AAEA,UAAI;AACH,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACvC,MAAM;AAAA,UACN,MAAM;AAAA,YACL,QAAQ;AAAA,YACR,QAAQ;AAAA,cACc,QAAOD,cAAG,MAAC,eAAe,UAAU,EAAE;AAAA,cAC3D,QAAQ,KAAK,SAAS;AAAA,cACtB,UAAU,KAAK,SAAS;AAAA,YACzB;AAAA,UACD;AAAA,SACA;AAED,YAAI,IAAI,OAAO,SAAS,GAAG;AAE1B,gBAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,mBAAS,SAAS,KAAK,SAAS;AAChC,mBAAS,WAAW,KAAK,SAAS;AAClCA,8BAAI,eAAe,YAAY,QAAQ;AAEvCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,WACP;AAED,qBAAW,MAAM;AAChBA,0BAAAA,MAAI,aAAa;AAAA,UACjB,GAAE,IAAI;AAAA,eACD;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,OAAO,WAAW;AAAA,YAC7B,MAAM;AAAA,WACN;AAAA,QACF;AAAA,MACD,SAAS,GAAG;AACXA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AACDA,sBAAAA,MAAc,MAAA,SAAA,8BAAA,CAAC;AAAA,MAChB;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;AChKA,GAAG,WAAW,eAAe;"}