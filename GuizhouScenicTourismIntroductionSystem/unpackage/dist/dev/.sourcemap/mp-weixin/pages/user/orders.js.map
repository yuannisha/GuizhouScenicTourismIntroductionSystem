{"version":3,"file":"orders.js","sources":["pages/user/orders.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9vcmRlcnMudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"orders-container\">\r\n\t\t<!-- 订单列表 -->\r\n\t\t<scroll-view \r\n\t\t\tclass=\"orders-list\"\r\n\t\t\tscroll-y\r\n\t\t\t@scrolltolower=\"loadMore\"\r\n\t\t\trefresher-enabled\r\n\t\t\t:refresher-triggered=\"isRefreshing\"\r\n\t\t\t@refresherrefresh=\"refresh\"\r\n\t\t>\r\n\t\t\t<view \r\n\t\t\t\tclass=\"order-item\"\r\n\t\t\t\tv-for=\"(item, index) in orderList\"\r\n\t\t\t\t:key=\"index\"\r\n\t\t\t>\r\n\t\t\t\t<view class=\"scenic-info\" @click=\"goToDetail(item)\">\r\n\t\t\t\t\t<image :src=\"item.scenic.cover\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"info\">\r\n\t\t\t\t\t\t<text class=\"name\">{{item.scenic.name}}</text>\r\n\t\t\t\t\t\t<text class=\"location\">{{item.scenic.location}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order-info\">\r\n\t\t\t\t\t<view class=\"booking-info\">\r\n\t\t\t\t\t\t<text class=\"date\">预订日期：{{formatDate(item.booking_date)}}</text>\r\n\t\t\t\t\t\t<text class=\"ticket\">{{item.ticket_type}} x {{item.quantity}}</text>\r\n\t\t\t\t\t\t<text class=\"price\">¥{{item.total_price}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"status-action\">\r\n\t\t\t\t\t\t<text class=\"status\" :class=\"item.status\">{{statusText[item.status]}}</text>\r\n\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\tclass=\"cancel-btn\" \r\n\t\t\t\t\t\t\tv-if=\"item.status === 'pending' && !isExpired(item.booking_date)\"\r\n\t\t\t\t\t\t\t@click=\"handleCancel(item._id)\"\r\n\t\t\t\t\t\t>取消预订</button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载状态 -->\r\n\t\t\t<view class=\"loading-status\">\r\n\t\t\t\t<text v-if=\"loading\">加载中...</text>\r\n\t\t\t\t<text v-else-if=\"noMore\">没有更多了</text>\r\n\t\t\t\t<text v-else-if=\"orderList.length === 0\">暂无订单</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { formatDate } from '@/utils/date.js'\r\n/**\r\n * 我的订单页面\r\n * @description 展示用户的景区门票预订订单\r\n */\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\torderList: [],\r\n\t\t\tpage: 1,\r\n\t\t\tpageSize: 10,\r\n\t\t\tloading: false,\r\n\t\t\tnoMore: false,\r\n\t\t\tisRefreshing: false,\r\n\t\t\tstatusText: {\r\n\t\t\t\tpending: '待使用',\r\n\t\t\t\tcancelled: '已取消'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\tthis.loadOrders()\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 加载订单列表\r\n\t\t */\r\n\t\tasync loadOrders() {\r\n\t\t\tif (this.loading || this.noMore) return\r\n\t\t\t\r\n\t\t\tthis.loading = true\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'scenic-center',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'getBookingList',\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tUSERID: uni.getStorageSync('userInfo')._id,\r\n\t\t\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\t\t\tpageSize: this.pageSize\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n                console.log(\"订单列表\",res)\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tconst list = res.result.data\r\n                    const total = res.result.data.length\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.page === 1) {\r\n\t\t\t\t\t\tthis.orderList = list\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.orderList = [...this.orderList, ...list]\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.noMore = this.orderList.length >= total\r\n\t\t\t\t\tthis.page++\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '加载失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '加载失败，请稍后重试',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tthis.isRefreshing = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 处理取消预订\r\n\t\t */\r\n\t\tasync handleCancel(orderId) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '确定要取消预订吗？',\r\n\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\t\t\t\tname: 'scenic-center',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: 'cancelBooking',\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\tUSERID: uni.getStorageSync('userInfo')._id,\r\n\t\t\t\t\t\t\t\t\t\tbookingId: orderId\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '取消成功'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tthis.refresh()\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: res.result.message || '取消失败',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '取消失败，请重试',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 判断是否过期\r\n\t\t */\r\n\t\tisExpired(date) {\r\n\t\t\treturn new Date(date) < new Date()\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 跳转到景点详情\r\n\t\t */\r\n\t\tgoToDetail(item) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: `/pages/scenic/detail?id=${item.scenic_id}`\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 刷新列表\r\n\t\t */\r\n\t\trefresh() {\r\n\t\t\tthis.isRefreshing = true\r\n\t\t\tthis.page = 1\r\n\t\t\tthis.noMore = false\r\n\t\t\tthis.loadOrders()\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 加载更多\r\n\t\t */\r\n\t\tloadMore() {\r\n\t\t\tif (!this.loading && !this.noMore) {\r\n\t\t\t\tthis.loadOrders()\r\n\t\t\t}\r\n\t\t},\r\n\t\r\n\t\t/**\r\n\t\t * 格式化日期\r\n\t\t */\r\n\t\t formatDate(timestamp) {\r\n\t\t\treturn formatDate(timestamp)\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.orders-container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n\tpadding: 20rpx;\r\n\t\r\n\t.orders-list {\r\n\t\theight: 100vh;\r\n\t\t\r\n\t\t.order-item {\r\n\t\t\tmargin-bottom: 20rpx;\r\n\t\t\tpadding: 20rpx;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tborder-radius: 12rpx;\r\n\t\t\t\r\n\t\t\t.scenic-info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 160rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.info {\r\n\t\t\t\t\tflex: 1;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.name {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.location {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #666;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.order-info {\r\n\t\t\t\t.booking-info {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.date {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #666;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.ticket {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #666;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.price {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.status-action {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.status {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t&.pending {\r\n\t\t\t\t\t\t\tcolor: #faad14;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t&.confirmed {\r\n\t\t\t\t\t\t\tcolor: #52c41a;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t&.cancelled {\r\n\t\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.cancel-btn {\r\n\t\t\t\t\t\tmargin: 0;\r\n\t\t\t\t\t\tpadding: 0 20rpx;\r\n\t\t\t\t\t\theight: 48rpx;\r\n\t\t\t\t\t\tline-height: 48rpx;\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #666;\r\n\t\t\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\t\t\tborder-radius: 24rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.loading-status {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 20rpx;\r\n\t\t\t\r\n\t\t\ttext {\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/liululuprogram/first/GuizhouScenicTourismIntroductionSystem/pages/user/orders.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni","res","formatDate"],"mappings":"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"}