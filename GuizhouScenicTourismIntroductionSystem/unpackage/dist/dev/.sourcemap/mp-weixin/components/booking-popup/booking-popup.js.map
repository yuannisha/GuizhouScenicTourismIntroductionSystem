{"version":3,"file":"booking-popup.js","sources":["components/booking-popup/booking-popup.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovcHJvZ3JhbXMyMDI0dG8yMDI1L2xpdWx1bHVwcm9ncmFtL2ZpcnN0L0d1aXpob3VTY2VuaWNUb3VyaXNtSW50cm9kdWN0aW9uU3lzdGVtL2NvbXBvbmVudHMvYm9va2luZy1wb3B1cC9ib29raW5nLXBvcHVwLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"booking-popup\" v-if=\"show\">\r\n\t\t<view class=\"mask\" @click=\"handleClose\"></view>\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"header\">\r\n\t\t\t\t<text class=\"title\">预订门票</text>\r\n\t\t\t\t<text class=\"close\" @click=\"handleClose\">×</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form\">\r\n\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t<text class=\"label\">预订日期</text>\r\n\t\t\t\t\t<picker \r\n\t\t\t\t\t\tmode=\"date\" \r\n\t\t\t\t\t\t:start=\"startDate\" \r\n\t\t\t\t\t\t:end=\"endDate\" \r\n\t\t\t\t\t\t:value=\"bookingDate\"\r\n\t\t\t\t\t\t@change=\"handleDateChange\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<view class=\"picker\">{{bookingDate}}</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t<text class=\"label\">票种</text>\r\n\t\t\t\t\t<picker \r\n\t\t\t\t\t\t:range=\"ticketTypes\" \r\n\t\t\t\t\t\trange-key=\"name\"\r\n\t\t\t\t\t\t:value=\"selectedTicketIndex\"\r\n\t\t\t\t\t\t@change=\"handleTicketChange\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<view class=\"picker\">\r\n\t\t\t\t\t\t\t{{ticketTypes[selectedTicketIndex].name}}\r\n\t\t\t\t\t\t\t(¥{{ticketTypes[selectedTicketIndex].price}})\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t<text class=\"label\">数量</text>\r\n\t\t\t\t\t<view class=\"quantity-control\">\r\n\t\t\t\t\t\t<text class=\"minus\" @click=\"handleQuantityChange(-1)\">-</text>\r\n\t\t\t\t\t\t<text class=\"number\">{{quantity}}</text>\r\n\t\t\t\t\t\t<text class=\"plus\" @click=\"handleQuantityChange(1)\">+</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"total\">\r\n\t\t\t\t\t<text class=\"label\">总价</text>\r\n\t\t\t\t\t<text class=\"price\">¥{{totalPrice}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"footer\">\r\n\t\t\t\t<button class=\"submit-btn\" @click=\"handleSubmit\">确认预订</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 预订弹窗组件\r\n * @description 用于预订门票的弹窗组件\r\n * @property {Boolean} show 是否显示弹窗\r\n * @property {String} scenicId 景点ID\r\n * @property {Array} tickets 门票列表\r\n * @event {Function} close 关闭弹窗\r\n * @event {Function} submit 提交预订\r\n */\r\nexport default {\r\n\tname: 'booking-popup',\r\n\tprops: {\r\n\t\tshow: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tscenicId: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\ttickets: {\r\n\t\t\ttype: Array,\r\n\t\t\trequired: true\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tbookingDate: this.getDefaultDate(),\r\n\t\t\tselectedTicketIndex: 0,\r\n\t\t\tquantity: 1\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tstartDate() {\r\n\t\t\tconst today = new Date()\r\n\t\t\treturn this.formatDate(today)\r\n\t\t},\r\n\t\tendDate() {\r\n\t\t\tconst date = new Date()\r\n\t\t\tdate.setDate(date.getDate() + 30)\r\n\t\t\treturn this.formatDate(date)\r\n\t\t},\r\n\t\tticketTypes() {\r\n\t\t\treturn this.tickets || []\r\n\t\t},\r\n\t\ttotalPrice() {\r\n\t\t\tif (!this.ticketTypes.length) return 0\r\n\t\t\treturn (this.ticketTypes[this.selectedTicketIndex].price * this.quantity).toFixed(2)\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgetDefaultDate() {\r\n\t\t\treturn this.formatDate(new Date())\r\n\t\t},\r\n\t\tformatDate(date) {\r\n\t\t\treturn `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\r\n\t\t},\r\n\t\thandleClose() {\r\n\t\t\tthis.$emit('close')\r\n\t\t\tthis.resetForm()\r\n\t\t},\r\n\t\thandleDateChange(e) {\r\n\t\t\tthis.bookingDate = e.detail.value\r\n\t\t},\r\n\t\thandleTicketChange(e) {\r\n\t\t\tthis.selectedTicketIndex = Number(e.detail.value)\r\n\t\t},\r\n\t\thandleQuantityChange(delta) {\r\n\t\t\tconst newQuantity = this.quantity + delta\r\n\t\t\tif (newQuantity >= 1 && newQuantity <= 10) {\r\n\t\t\t\tthis.quantity = newQuantity\r\n\t\t\t}\r\n\t\t},\r\n\t\tresetForm() {\r\n\t\t\tthis.bookingDate = this.getDefaultDate()\r\n\t\t\tthis.selectedTicketIndex = 0\r\n\t\t\tthis.quantity = 1\r\n\t\t},\r\n\t\tasync handleSubmit() {\r\n\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\tif (!userInfo) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'scenic-center',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'createBooking',\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tUSERID: userInfo._id,\r\n\t\t\t\t\t\t\tscenicId: this.scenicId,\r\n\t\t\t\t\t\t\tbookingDate: this.bookingDate,\r\n\t\t\t\t\t\t\tticketType: this.ticketTypes[this.selectedTicketIndex].name,\r\n\t\t\t\t\t\t\tquantity: this.quantity,\r\n\t\t\t\t\t\t\ttotalPrice: Number(this.totalPrice)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '预订成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.$emit('submit')\r\n\t\t\t\t\tthis.handleClose()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '预订失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '预订失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.booking-popup {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tz-index: 999;\r\n\t\r\n\t.mask {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t}\r\n\t\r\n\t.content {\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx 20rpx 0 0;\r\n\t\tpadding: 30rpx;\r\n\t\t\r\n\t\t.header {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: center;\r\n\t\t\tmargin-bottom: 30rpx;\r\n\t\t\t\r\n\t\t\t.title {\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.close {\r\n\t\t\t\tfont-size: 40rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tpadding: 10rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.form {\r\n\t\t\t.form-item {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin-bottom: 30rpx;\r\n\t\t\t\t\r\n\t\t\t\t.label {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.picker {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #666;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.quantity-control {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.minus, .plus {\r\n\t\t\t\t\t\twidth: 60rpx;\r\n\t\t\t\t\t\theight: 60rpx;\r\n\t\t\t\t\t\tline-height: 60rpx;\r\n\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.number {\r\n\t\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.total {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin-top: 30rpx;\r\n\t\t\t\tpadding-top: 30rpx;\r\n\t\t\t\tborder-top: 1rpx solid #eee;\r\n\t\t\t\t\r\n\t\t\t\t.label {\r\n\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.price {\r\n\t\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.footer {\r\n\t\t\tmargin-top: 30rpx;\r\n\t\t\t\r\n\t\t\t.submit-btn {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tline-height: 80rpx;\r\n\t\t\t\tbackground-color: #007AFF;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style> ","import Component from 'D:/programs2024to2025/liululuprogram/first/GuizhouScenicTourismIntroductionSystem/components/booking-popup/booking-popup.vue'\nwx.createComponent(Component)"],"names":["uni","uniCloud"],"mappings":"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"}