{"version":3,"file":"review-popup.js","sources":["components/review-popup/review-popup.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovcHJvZ3JhbXMyMDI0dG8yMDI1L2xpdWx1bHVwcm9ncmFtL2ZpcnN0L0d1aXpob3VTY2VuaWNUb3VyaXNtSW50cm9kdWN0aW9uU3lzdGVtL2NvbXBvbmVudHMvcmV2aWV3LXBvcHVwL3Jldmlldy1wb3B1cC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"review-popup\" v-if=\"show\">\r\n\t\t<view class=\"mask\" @click=\"handleClose\"></view>\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"header\">\r\n\t\t\t\t<text class=\"title\">发表评论</text>\r\n\t\t\t\t<text class=\"close\" @click=\"handleClose\">×</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"form\">\r\n\t\t\t\t<view class=\"score-section\" v-if=\"type === 'scenic' || type === 'food'\">\r\n\t\t\t\t\t<text class=\"label\">评分</text>\r\n\t\t\t\t\t<view class=\"score-input\">\r\n\t\t\t\t\t\t<slider \r\n\t\t\t\t\t\t\t:value=\"score * 10\" \r\n\t\t\t\t\t\t\t:min=\"0\" \r\n\t\t\t\t\t\t\t:max=\"50\" \r\n\t\t\t\t\t\t\t:step=\"1\"\r\n\t\t\t\t\t\t\t:show-value=\"false\"\r\n\t\t\t\t\t\t\t@change=\"handleScoreChange\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<text class=\"score-text\">{{score}}分</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<textarea \r\n\t\t\t\t\tv-model=\"content\" \r\n\t\t\t\t\tplaceholder=\"说说你的想法...\" \r\n\t\t\t\t\t:maxlength=\"500\"\r\n\t\t\t\t\tauto-height\r\n\t\t\t\t></textarea>\r\n\t\t\t\t<view class=\"image-list\" v-if=\"images.length > 0\">\r\n\t\t\t\t\t<image \r\n\t\t\t\t\t\tv-for=\"(item, index) in images\" \r\n\t\t\t\t\t\t:key=\"index\" \r\n\t\t\t\t\t\t:src=\"item\" \r\n\t\t\t\t\t\tmode=\"aspectFill\"\r\n\t\t\t\t\t\t@click=\"previewImage(index)\"\r\n\t\t\t\t\t></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"upload-btn\" @click=\"chooseImage\" v-if=\"images.length < 9\">\r\n\t\t\t\t\t<text class=\"icon\">+</text>\r\n\t\t\t\t\t<text class=\"text\">添加图片</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"footer\">\r\n\t\t\t\t<button class=\"submit-btn\" @click=\"handleSubmit\">发表评论</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 评论弹窗组件\r\n * @description 用于发表评论的弹窗组件\r\n * @property {Boolean} show 是否显示弹窗\r\n * @property {String} type 评论类型 (scenic/food/culture/guide)\r\n * @property {String} targetId 评论目标ID\r\n * @event {Function} close 关闭弹窗\r\n * @event {Function} submit 提交评论\r\n */\r\nexport default {\r\n\tname: 'review-popup',\r\n\tprops: {\r\n\t\tshow: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\ttargetId: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcontent: '',\r\n\t\t\timages: [],\r\n\t\t\tscore: 5.0,\r\n\t\t\tmaxImages: 9\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t/**\r\n\t\t * 处理评分变化\r\n\t\t */\r\n\t\thandleScoreChange(e) {\r\n\t\t\tthis.score = Number((e.detail.value / 10).toFixed(1))\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 关闭弹窗\r\n\t\t */\r\n\t\thandleClose() {\r\n\t\t\tthis.$emit('close')\r\n\t\t\tthis.content = ''\r\n\t\t\tthis.images = []\r\n\t\t\tthis.score = 5.0\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 选择图片\r\n\t\t */\r\n\t\tchooseImage() {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 9 - this.images.length,\r\n\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '上传中...'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst uploadTasks = res.tempFilePaths.map(path => {\r\n\t\t\t\t\t\t\treturn uniCloud.uploadFile({\r\n\t\t\t\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\t\t\t\tcloudPath: `review/${Date.now()}-${Math.random().toString(36).slice(-6)}.jpg`\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst results = await Promise.all(uploadTasks)\r\n\t\t\t\t\t\tthis.images = [...this.images, ...results.map(item => item.fileID)]\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '上传失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 预览图片\r\n\t\t */\r\n\t\tpreviewImage(index) {\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: this.images,\r\n\t\t\t\tcurrent: this.images[index]\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t/**\r\n\t\t * 提交评论\r\n\t\t */\r\n\t\tasync handleSubmit() {\r\n\t\t\tif (!this.content.trim()) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入评论内容',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst userInfo = uni.getStorageSync('userInfo')\r\n\t\t\tif (!userInfo) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst centerMap = {\r\n\t\t\t\t\tscenic: 'scenic-center',\r\n\t\t\t\t\tfood: 'food-center',\r\n\t\t\t\t\tculture: 'culture-center',\r\n\t\t\t\t\tguide: 'guide-center'\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst res = await uniCloud.callFunction({\r\n\t\t\t\t\tname: centerMap[this.type],\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\taction: 'addReview',\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tUSERID: userInfo._id,\r\n\t\t\t\t\t\t\t[`${this.type}_id`]: this.targetId,\r\n\t\t\t\t\t\t\tcontent: this.content,\r\n\t\t\t\t\t\t\timages: this.images,\r\n\t\t\t\t\t\t\tscore: this.score\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.result.code === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '评论成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.$emit('submit')\r\n\t\t\t\t\tthis.handleClose()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.result.message || '评论失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '评论失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.review-popup {\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tbottom: 0;\r\n\tz-index: 999;\r\n\t\r\n\t.mask {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t}\r\n\t\r\n\t.content {\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx 20rpx 0 0;\r\n\t\tpadding: 30rpx;\r\n\t\t\r\n\t\t.header {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: center;\r\n\t\t\tmargin-bottom: 30rpx;\r\n\t\t\t\r\n\t\t\t.title {\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.close {\r\n\t\t\t\tfont-size: 40rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tpadding: 10rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.form {\r\n\t\t\t.score-section {\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\r\n\t\t\t\t.label {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.score-input {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\r\n\t\t\t\t\tslider {\r\n\t\t\t\t\t\tflex: 1;\r\n\t\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.score-text {\r\n\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\t\ttext-align: right;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttextarea {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: 200rpx;\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\tborder-radius: 12rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.image-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tmargin: 0 -10rpx;\r\n\t\t\t\t\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: calc(33.33% - 20rpx);\r\n\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t\tmargin: 10rpx;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.upload-btn {\r\n\t\t\t\twidth: calc(33.33% - 20rpx);\r\n\t\t\t\theight: 200rpx;\r\n\t\t\t\tmargin: 10rpx;\r\n\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\t\r\n\t\t\t\t.icon {\r\n\t\t\t\t\tfont-size: 48rpx;\r\n\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.text {\r\n\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\tcolor: #999;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t.footer {\r\n\t\t\tmargin-top: 30rpx;\r\n\t\t\t\r\n\t\t\t.submit-btn {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tline-height: 80rpx;\r\n\t\t\t\tbackground-color: #007AFF;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style> ","import Component from 'D:/programs2024to2025/liululuprogram/first/GuizhouScenicTourismIntroductionSystem/components/review-popup/review-popup.vue'\nwx.createComponent(Component)"],"names":["uni","uniCloud"],"mappings":"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"}